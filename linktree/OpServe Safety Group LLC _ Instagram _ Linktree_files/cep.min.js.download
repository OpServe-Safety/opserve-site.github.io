!function(){var e={},t=null;function n(e){return this.enqueue=function(t,n,r){var o={data:t,config:n,resolver:r||function(){}};if(!r&&window.Promise)return new window.Promise((function(t){o.resolver=t,e.push([o.data,o.config,o.resolver])}));e.push([t,n,r])},this.sizeOf=function(){return e.length},this.consume=function(){return e.splice(0,e.length)},this}function r(e,t){if(!t)throw new Error("You must provide a queue to watch");var n=e,r=-1,o=null,s=t,i=!1;this.isWatching=!1,this.startWatching=function(e){o=e,this.processQueue(),window.clearInterval(r),this.isWatching=!0,r=window.setInterval(this.processQueue.bind(this),n)},this.stopWatching=function(){this.processQueue(),this.isWatching=!1,clearInterval(r)},this.processQueue=function(){if(!i){i=!0;var e=s.consume();o&&e.length>0&&o(e),i=!1}}}window.__lter=window.__lter||{q:[],trackEvent:function(){},generateSesDat:function(){return null}},e._globalVar="__lter",e._retryMax=5;var o=function(){var e,t=[];for(let e=0;e<256;++e)t.push((e+256).toString(16).substr(1));var n=new Uint8Array(16);return function(){var r=function(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(n)}();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,n=0){return(t[e[n+0]]+t[e[n+1]]+t[e[n+2]]+t[e[n+3]]+"-"+t[e[n+4]]+t[e[n+5]]+"-"+t[e[n+6]]+t[e[n+7]]+"-"+t[e[n+8]]+t[e[n+9]]+"-"+t[e[n+10]]+t[e[n+11]]+t[e[n+12]]+t[e[n+13]]+t[e[n+14]]+t[e[n+15]]).toLowerCase()}(r)}}();function s(e){if(!e)return"";try{var t=new URL(e);if(e.length<=100)return e;var n=t.protocol+"//"+t.hostname;return n.length<=100?n:""}catch(e){return""}}e.version=1,e.sendEvent=function(t,n,r,s){s=s||function(){};var i=!1,a=e.getSessionId(o,r);if(a&&!r.sessionId&&(1===e.version?r.sessionId=a:2===e.version&&r.eventPayload?r.eventPayload.sessionId=a:r.browser&&(r.browser.sessionId=a)),n&&!r.browserId&&(1===e.version?r.browserId=n:2===e.version&&r.eventPayload?r.eventPayload.browserId=n:r.browser&&(r.browser.browserId=n)),e.updateSessionExpiry(r),n&&navigator&&navigator.sendBeacon&&"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(t,JSON.stringify(r)))return i=!0,void setTimeout((function(){s(null,{browserId:n})}),1e3);if(!i&&window.fetch&&"CREATE"!==r.eventType)try{fetch(t,{method:"POST",mode:"cors",cache:"no-cache",keepalive:!0,headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(r)}).then((function(e){if(e.ok)return e.json();throw new Error("Response from server not ok.")})).then((function(e){s(null,e?e.data:{})})).catch((function(n){e.doTraditionalXHR(t,r,s)}))}catch(n){e.doTraditionalXHR(t,r,s)}else i||e.doTraditionalXHR(t,r,s)},e.doTraditionalXHR=function(t,n,r){var o=new window.XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=e.xhrCallback(r),o.send(JSON.stringify(n))},e.xhrCallback=function(e){return function(){if(4===this.readyState)if(this.status>=200&&this.status<400)try{var t=JSON.parse(this.response);if(200!==t.statusCode)throw new Error("Invalid response code from server");e(null,t.data)}catch(t){e(t,null)}else e(new Error("Server responded with error"),null)}},e.isLinktree=function(){return window.location.host.endsWith("linktr.ee")},e.oneTrustIsLoaded=function(){return"string"==typeof window.OnetrustActiveGroups},e.hasPerformanceCookieConsent=function(){return!e.oneTrustIsLoaded()||window.OnetrustActiveGroups.includes("C0002")},e.wipePerformanceData=function(e,t){document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;${t?` domain=${t};`:""}`,window.localStorage.removeItem(e)},e.storePerformanceData=function(t,n,r,o,s){if(window.sessionStorage.setItem(t,n),e.hasPerformanceCookieConsent()){let e=`${t}=${n}; path=/; samesite=none; secure;`;r&&(e+=` max-age=${r};`),o&&(e+=` expires=${o};`),s&&(e+=` domain=${s};`),document.cookie=e,window.localStorage.setItem(t,n)}else e.wipePerformanceData(t,s)},e.decodeSesDat=function(e){try{for(var t=e.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var n=atob(t).split("|");return n.length<3||n.length>5?null:{browserId:n[0]||null,sessionId:n[1]||null,sessionExpiry:n[2]||null,sessionStart:n[3]||null,originalReferrer:n[4]||null}}catch(e){return console.warn("Failed to decode ses_dat:",e),null}},e.generateSesDat=function(e){try{if(!e||"object"!=typeof e)throw new Error("Data parameter must be an object");var t=e.browserId||null,n=e.sessionId||null,r=e.sessionExpiry||null,o=e.sessionStart||null,i=s(e.originalReferrer)||null;if(!(t&&n&&r&&o))return null;var a=[t,n||"",r||"",o||"",i||""].join("|");return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(e){return console.warn("Failed to generate ses_dat:",e),null}},e.getPerformanceData=function(t){return e.getCookieValue(t)||window.localStorage.getItem(t)||window.sessionStorage.getItem(t)},e.getBrowserId=function(t,n){var r=e.getPerformanceData("browserId")||t();if(r)return e.storeBrowserId(r),void n(null,r);throw new Error("VanillaCEP: Unable to fetch or generate browserId")},e.storeBrowserId=function(t){e.storePerformanceData("browserId",t,"31536000","Tue, 30 Mar 2099 03:14:07 GMT",e.isLinktree()?"linktr.ee":"")},e.processItems=function(n,r){for(;n.length>0;){var o=n.shift();e.sendEvent(o[1].endpoint,t,o[0],(function(){o[2]()}))}r&&r(null,!0)},e.unmungeAnalyticsUrl=function(e){if(e){var t=e.substr(0,Math.ceil(e.length/2));return[e.substr(Math.ceil(e.length/2),e.length).split("").reverse().join(""),t].join("")}},e.getDataUrlFromDocumentElement=function(){var t=document.getElementById("__ltcep");if(t&&"script"===t.tagName.toLowerCase())return e.unmungeAnalyticsUrl(t.attributes["data-url"].value)},e.getVersionIfPresent=function(){var e=document.getElementById("__ltcep");return e&&"script"===e.tagName.toLowerCase()&&e.attributes["data-version"]?parseInt(e.attributes["data-version"].value):1},e.getSessionId=function(t,n){var r=e.getPerformanceData("sessionId"),o=e.getSessionTimestamp("sessionStart"),s=e.getSessionTimestamp("sessionExpiry"),i=Date.parse(n.createdAt);return isNaN(i)&&(i=Date.now(),n.createdAt=(new Date).toISOString()),r&&o&&s&&!(i>s.getTime())||(r=t(),o=new Date(i),e.storeOriginalReferrer(document.referrer)),e.storeSessionId(r),e.storeSessionStart(o),r},e.storeSessionId=function(t){e.storePerformanceData("sessionId",t,"31536000","Tue, 30 Mar 2099 03:14:07 GMT",e.isLinktree()?".linktr.ee":"")},e.getCookieValue=function(e){const t=("; "+document.cookie).split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},e.getSessionTimestamp=function(t){var n=e.getPerformanceData(t);return n?new Date(n):null},e.storeSessionExpiry=function(t){e.storePerformanceData("sessionExpiry",t.toString(),null,t.toUTCString(),e.isLinktree()?".linktr.ee":"")},e.storeSessionStart=function(t){e.storePerformanceData("sessionStart",t.toString(),null,"Tue, 30 Mar 2099 03:14:07 GMT",e.isLinktree()?".linktr.ee":"")},e.storeOriginalReferrer=function(t){var n=s(t);e.storePerformanceData("originalReferrer",n,null,"Tue, 30 Mar 2099 03:14:07 GMT",e.isLinktree()?".linktr.ee":"")},e.updateSessionExpiry=function(t){var n=Date.parse(t.createdAt),r=new Date(n+18e5);e.storeSessionExpiry(r)},e.syncSessionDataFromCookies=function(){const t=e.getCookieValue("sessionId");t&&(window.localStorage.setItem("sessionId",t),window.sessionStorage.setItem("sessionId",t));const n=e.getCookieValue("sessionStart");n&&(window.localStorage.setItem("sessionStart",n),window.sessionStorage.setItem("sessionStart",n));const r=e.getCookieValue("sessionExpiry");r&&(window.localStorage.setItem("sessionExpiry",r),window.sessionStorage.setItem("sessionExpiry",r));const o=e.getCookieValue("originalReferrer");o&&(window.localStorage.setItem("originalReferrer",o),window.sessionStorage.setItem("originalReferrer",o))},e.syncSessionDataFromUrlParams=function(){try{var t=new URLSearchParams(window.location.search).get("ses_dat");if(!t)return;var n=e.decodeSesDat(t);if(!n)return;n.browserId&&e.storeBrowserId(n.browserId),n.sessionId&&e.storeSessionId(n.sessionId),n.sessionExpiry&&e.storeSessionExpiry(new Date(n.sessionExpiry)),n.sessionStart&&e.storeSessionStart(new Date(n.sessionStart)),n.originalReferrer&&e.storeOriginalReferrer(n.originalReferrer)}catch(e){console.warn("Failed to sync session data from URL params:",e)}};var i=function(e,n,r,o,s){e.syncSessionDataFromCookies(),e.syncSessionDataFromUrlParams(),window.__lter&&(window.__lter.trackEvent=n.enqueue.bind(n),window.__lter.generateSesDat=e.generateSesDat.bind(e)),o||(o=e.getDataUrlFromDocumentElement()),e.version=e.getVersionIfPresent(),e.getBrowserId(s,(function(n,o){t=o,r.startWatching(e.processItems)}))};if("undefined"!=typeof module&&"object"==typeof module.exports)return void(module.exports={init:i,api:e,EventQueue:n,Watcher:r,uuidv4:o});var a=new n(window.__lter.q),u=new r(200,a);document.addEventListener("visibilitychange",(function(){"hidden"==document.visibilityState&&u.processQueue()})),window.addEventListener("pagehide",u.processQueue),window.addEventListener("unload",u.processQueue),i(e,a,u,null,o);const l=window.setInterval(()=>{e.oneTrustIsLoaded()&&(clearInterval(l),e.hasPerformanceCookieConsent()||(e.wipePerformanceData("browserId",e.isLinktree()?"linktr.ee":""),e.wipePerformanceData("sessionId",e.isLinktree()?".linktr.ee":""),e.wipePerformanceData("sessionStart",e.isLinktree()?".linktr.ee":""),e.wipePerformanceData("sessionExpiry",e.isLinktree()?".linktr.ee":""),e.wipePerformanceData("originalReferrer",e.isLinktree()?".linktr.ee":"")))},100)}(window);
